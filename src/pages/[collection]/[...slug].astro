---
import { getCollection, render } from "astro:content";
import { LinkPreview } from "@astro-community/astro-embed-link-preview";
import Layout from "../../layouts/Layout.astro";
import { collectionNames } from "../../content.config";

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
  let paths = [];
  for (const collection of collectionNames) {
    const posts = await getCollection(collection);
    const collectionPaths = posts.map((post) => ({
      params: { collection: post.collection, slug: post.id },
      props: { post },
    }));
    paths = paths.concat(collectionPaths);
  }
  return paths;
}

// 2. For your template, you can get the entry directly from the prop
const { post } = Astro.props;
const { Content } = await render(post);
---

<Layout>
  {
    post.collection === "links" ? (
      <Layout>
        <h1>Links</h1>
        <LinkPreview id={post.id} />
        <p>post.data.rating: {post.data.rating}</p>
      </Layout>
    ) : (
      <Layout>
        <h1>{post.data.title}</h1>
        <Content />
      </Layout>
    )
  }
</Layout>
