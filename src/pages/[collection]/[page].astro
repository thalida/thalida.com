---
import { getCollection, render } from "astro:content";
import { COLLECTION_CHOICES, collectionOrder, collectionMeta } from "../../content.config";
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";
import BlogPostCard from "../../components/BlogPostCard.astro";

const { page } = Astro.props;
const params = Astro.params;
const collection = collectionMeta[params.collection]

export async function getStaticPaths({ paginate }) {
  let paths = [];

  for (const collection of COLLECTION_CHOICES) {
    const posts = await getCollection(collection);
    posts.sort((a, b) => {
      const dateA = new Date(a.data.updatedOn || a.data.publishedOn).getTime();
      const dateB = new Date(b.data.updatedOn || b.data.publishedOn).getTime();
      return dateB - dateA; // Sort in descending order
    });
    const paginatedPosts = paginate(posts, {
      params: { collection, page: 1 },
      pageSize: 20,
    });
    paths = paths.concat(paginatedPosts);
  }

  return paths;
}
---


<Layout>
  <div class="p-8">

    <Header />

    <div class={`@container my-8 p-8 flex flex-col gap-4 ${collection.bgColor} rounded-3xl text-center`}>
      <h1 class={`text-5xl lg:text-7xl font-brand ${collection.headerColor} pb-2 lg:pb-4 mb-2`}>
        {collection.title}
      </h1>
      <p class="text-base lg:text-xl">{collection.description}</p>
    </div>

    <div class="flex flex-row items-center justify-between my-8 gap-8">
      <p class="text-sm opacity-50 mt-4"> Showing <span class="font-bold">{page.start + 1}</span> to <span class="font-bold">{page.end + 1}</span> of <span class="font-bold">{page.total}</span> posts </p>
      <div class="flex flex-row items-center justify-between gap-4 mt-4">
        <a href={page.url.prev || '#'} class={page.url.prev ? 'button-link ' : 'button-link opacity-20 cursor-default pointer-events-none'} aria-label="Previous page">
          <i class="fa-solid fa-arrow-left"></i>
          <span class="hidden sm:inline">Previous</span>
        </a>
        <a href={page.url.next || '#'} class={page.url.next ? 'button-link text-right ' : 'button-link opacity-20 cursor-default text-right'} aria-label="Next page">
          <span class="hidden sm:inline">Next</span>
          <i class="fa-solid fa-arrow-right"></i>
        </a>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-8">
      {
        page.data.map((post) => (
        <BlogPostCard post={post} />
        ))
      }
    </div>

    <div class="flex flex-row items-center justify-between my-8 gap-8">
      <p class="text-sm opacity-50 mt-4"> Showing <span class="font-bold">{page.start + 1}</span> to <span class="font-bold">{page.end + 1}</span> of <span class="font-bold">{page.total}</span> posts </p>
      <div class="flex flex-row items-center justify-between gap-4 mt-4">
        <a href={page.url.prev || '#'} class={page.url.prev ? 'button-link ' : 'button-link opacity-20 cursor-default pointer-events-none'} aria-label="Previous page">
          <i class="fa-solid fa-arrow-left"></i>
          <span class="hidden sm:inline">Previous</span>
        </a>
        <a href={page.url.next || '#'} class={page.url.next ? 'button-link text-right ' : 'button-link opacity-20 cursor-default text-right'} aria-label="Next page">
          <span class="hidden sm:inline">Next</span>
          <i class="fa-solid fa-arrow-right"></i>
        </a>
      </div>
    </div>

  </div>
</Layout>
